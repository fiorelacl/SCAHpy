# Tutorial 02: CROCO Model Outputs

In this tutorial, you will learn how to:

1. Read a single file or multiple files from the **CROCO** model using SCAHpy.
2. Perform basic diagnostics such as computing the surface SST gradient.
3. Generate a 2D map, a Hovmöller diagram, and a simple time series using oceanographic variables.

This workflow is ideal for getting started with the oceanic component outputs of the coupled *IGP RESM-COW* model, or with any compatible CROCO simulation.

## Reading a CROCO File

In this first section we begin by working with *a single CROCO file*, which allows us to understand the basic structure of the dataset and the use of the main functions. Later, we will extend these concepts to the case of *multiple-file reading*.

### 1. Importing Packages

We import the modules required for path handling, CROCO file reading, and numerical operations:

As in the previous tutorial, we import the necessary modules:

```python
import scahpy as sc
import numpy as np
import glob
import xarray as xr
```

### 2. Defining the CROCO File

SCAHpy’s reading functions require that file paths be provided as a *list of strings*.
There are two ways to achieve this:

**a) Manually placing the file inside brackets:**

```python
file_name = ['/data/users/fcastillon/croco/croco_avg_Y2017M01.nc']
```

**b) Using `glob.glob`, which directly returns a list:**

```python
file_name = glob.glob('/data/users/fcastillon/croco/croco_avg_Y2017M01.nc')
```

Both methods produce the correct format required by SCAHpy.

### 3. Selecting Variables with `drop_vars`

To optimize reading performance, we can specify which variables to exclude from the CROCO file.
This is especially useful in heavy simulations or when working with multiple files.

The function `drop_vars` has one important point:

> **It always requires a single file (`file0`) in string format, even when working with multiple files.**
> This is because the function analyzes the typical structure and metadata of a CROCO file to identify variables that should be excluded.

Therefore, even if `file_name` contains more than one file, we use:

```python
file_name[0]
```

In this example, we will work with only four variables: `mask_rho`, `temp`, `u`, and `v`.

```python
vars_croco = sc.drop_vars(
    file_name[0],
    sel_vars = ['temp','mask_rho','u','v'],
    model = 'CROCO'
)
```

### 4. Reading the File with `read_croco`

Next, we read the file using the `read_croco` function, specifying the main options:

* **`drop_vars`**: variables to exclude (obtained previously).
* **`destag`**: whether destaggering is required; in this example it is necessary for the `u` and `v` velocity components.
* **`save_path`**: optional path to save the processed file.

```python
ds_croco = sc.read_croco(
    file_paths = file_name,
    drop_vars = vars_croco,
    destag = True,
    save_path = None
)
```

### 5. Applying a Mask to Extract Ocean Regions

If we want to plot only the **oceanic** region, we can use `apply_mask`, which belongs to the module `scahpy.core`.

In this case we retain only ocean values, so we set `sea_is_one = True` and pass the grid mask variable `mask_rho`:

```python
ds_croco_mask = sc.apply_mask(
    da = ds_croco[['temp','u','v']],
    mask = ds_croco.mask_rho,
    sea_is_one = True
).isel(levels=-1)
```

### 6. 2D Map: SST with Velocity Vectors

Since the variables are defined on different vertical levels, `.isel(levels=-1)` selects the level closest to the surface.

* **`da`**: scalar variable to plot (`temp`).
* **`U`, `V`**: velocity components.
* **`levels`**: contour levels.
* **`cmap`**: color palette.
* **`quiver_subsample`**: subsampling frequency for vectors.
* **`quiverkey_speed`**: reference vector magnitude.
* **`time`**: timestamp of the plot.
* **`output_path`**: optional path to save the figure.

```python
sc.map_1var_winds(
    da = ds_croco_mask.temp,
    U = ds_croco_mask.u,
    V = ds_croco_mask.v,
    time = '2017-01-14',
    cmap = 'jet',
    levels = np.arange(18,30,1),
    quiverkey_speed = 1,
    title = 'Sea Surface Temperature',
    colorbar_label = '°C'
)
```

![ds\_maps](figs/fig_07.png){#fig-07 fig-align="center" width="75%"}

For more details on each parameter, see the [API Reference](04_API.qmd).

### 7. Time Series

```python
sc.ts_area_1var(
    da = ds_croco_mask.temp,
    lat_range = (-10,0),
    lon_range  = (-90,-80),
    label  = 'IGP RESM-COW',
    color = '#1b9e77',
    linestyle  = '-',
    linewidth  = 1.8,
    title  = 'Time Series at Niño 1+2',
    ylabel  = 'SST °C'
)
```

![ds\_maps](figs/fig_08.png){#fig-08 fig-align="center" width="75%"}

## Reading Multiple CROCO Files

In this section, we extend the previous procedure to work with **multiple CROCO files** belonging to the same simulation.

### 1. Importing Packages

We begin by importing the required modules:

```python
import scahpy as sc
import numpy as np
import glob
import xarray as xr
```
