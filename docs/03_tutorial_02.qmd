# Tutorial 02: Salidas del modelo CROCO

En este tutorial aprenderás a:

1. Leer un único archivo o múltiples archivos del modelo **CROCO** usando SCAHpy.  
2. Realizar diagnósticos básicos como obtener el gradiente de SST en superficie.  
3. Generar un mapa 2D, hovmoller y una serie de tiempo sencilla con variables oceanográficas.

Este flujo es ideal para comenzar a trabajar con las salidas de la componente
oceánica del modelo acoplado *IGP RESM-COW* o de cualquier simulación CROCO compatible.

## Lectura de un archivo CROCO

En esta primera parte comenzaremos trabajando con *un solo archivo CROCO*, lo cual permite comprender la estructura básica del dataset y el uso de las funciones principales. Más adelante extenderemos estos conceptos para el caso de *lecturas múltiples*.

### 1. Importación de paquetes

Importamos los módulos necesarios para el manejo de rutas, lectura de archivos CROCO y operaciones numéricas:

Como en el tutorial anterior, importamos los módulos necesarios:

```python
import scahpy as sc
import numpy as np
import glob
import xarray as xr
```
### 2. Definición del archivo CROCO

Las funciones de lectura de SCAHpy requieren que las rutas de los archivos se proporcionen como *lista de strings*.
Existen dos formas de lograrlo:

**a) Colocar manualmente el archivo entre corchetes:**

```python
file_name = ['/data/users/fcastillon/croco/croco_avg_Y2017M01.nc']
```

**b) Utilizar `glob.glob`, que devuelve directamente una lista:**

```python
file_name = glob.glob('/data/users/fcastillon/croco/croco_avg_Y2017M01.nc')
```

Ambos métodos son equivalentes respecto al formato que necesita SCAHpy.

### 3. Selección de variables con `drop_vars`

Para optimizar la lectura, podemos indicar qué variables excluir del archivo CROCO. 
Esto es especialmente útil en simulaciones pesadas o cuando se trabaja con múltiples archivos.

La función `drop_vars` tiene un punto importante:

> **Siempre requiere un único archivo (`file0`), en formato string, aun cuando trabajemos con múltiples archivos.**
> Esto se debe a que la función analiza la estructura y *metadata* típica del archivo CROCO para identificar las variables que deben excluirse.

Por ello, incluso si `file_name` contiene más de un archivo, utilizamos:

```python
file_name[0]
```

En este ejemplo trabajaremos solo con cuatro variables: `mask_rho`, `temp`, `u` y `v`.

```python
vars_croco = sc.drop_vars(file_name[0],
                          sel_vars = ['temp','mask_rho','u','v'],
                          model = 'CROCO')
```

### 4. Lectura del archivo con `read_croco`

A continuación, leemos el archivo usando la función `read_croco`, pasando las opciones principales:

* **`drop_vars`**: variables a excluir (obtenidas previamente).
* **`destag`**: si se requiere destaggering; en este ejemplo sí es necesario por los vectores de viento u y v.
* **`save_path`**: ruta opcional para guardar el archivo procesado.

```python
ds_croco = sc.read_croco(file_paths = file_name,
                         drop_vars = vars_croco,
                         destag = True,
                         save_path = None)
```
### 5. Aplicación de máscara para delimitar continente

Si deseamos graficar solo la zona **oceánica**, podemos usar `apply_mask`, que pertenece al módulo: `scahpy.core`

En este caso mantendremos únicamente el océano, por lo que usamos `sea_is_one = True` y pasamos la variable que tiene la máscara que es `mask_rho`

```python
ds_croco_mask = sc.apply_mask(da = ds_croco[['temp','u','v']],
                              mask = ds_croco.mask_rho,
                              sea_is_one = True).isel(levels=-1)
```

### 6. Mapa 2D: SST con vectores del viento
Como las variables son a distintos niveles verticales, al hacer `.isel(levels=-1)` seleccionamos el nivel más cercano a la superficie.

* **`da`**: variable escalar a graficar (temp).
* **`U`, `V`**: componentes del viento.
* **`levels`**: niveles del contorno.
* **`cmap`**: paleta de colores.
* **`quiver_subsample`**: frecuencia de muestreo para los vectores.
* **`quiverkey_speed`**: escala de referencia.
* **`time`**: tiempo a graficar.
* **`output_path`**: ruta para guardar la figura (si se desea).

```python
sc.map_1var_winds(da = ds_croco_mask.temp,
                  U = ds_croco_mask.u,
                  V = ds_croco_mask.v,
                  time = '2017-01-14',
                  cmap = 'jet',
                  levels = np.arange(18,30,1),
                  quiverkey_speed = 1,
                  title = 'Sea Surface Temperature',
                  colorbar_label = '°C')
```
![ds_maps](figs/fig_07.png){#fig-07 fig-align="center" width="75%"}

Más detalles de cada parámetro, revisar la sección [Referencia de la API](04_API.qmd).

### 7. Serie de Tiempo 

```python
sc.ts_area_1var(da = ds_croco_mask.temp,
    lat_range = (-10,0),
    lon_range  = (-90,-80),
    label  = 'IGP RESM-COW',
    color = '#1b9e77',
    linestyle  = '-',
    linewidth  = 1.8,
    title  = 'Time Series at Niño 1+2',
    ylabel  = 'SST °C')
```
![ds_maps](figs/fig_08.png){#fig-08 fig-align="center" width="75%"}

## Lectura de múltiples archivos CROCO

En esta sección extenderemos el procedimiento anterior para trabajar con **múltiples archivos CROCO** correspondientes a una misma simulación. 

### 1. Importación de paquetes

Comenzamos importando los módulos necesarios:

```python
import scahpy as sc
import numpy as np
import glob
import xarray as xr
```
